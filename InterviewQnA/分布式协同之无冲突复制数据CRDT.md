# CRDT

CRDT = Conflict-free Replicated Data Type

CRDT 是一种无冲突的数据结构，能够在分布式系统中存在多个该结构的实例，并且能够在多个实例之间进行同步。

它的同步是一种可靠的方式，在数学上能够保证多个不同数据源的数据合并的一致性。

## 两种类型

理论上两种类型的数学模型是一样的。核心的步骤在于处理的数据之间需要进行 merge 操作，以保证数据的一致性。

1. 基于 state 的 CRDT
   1. 每个实例收发全量的状态，传输的数据量比较大
2. 基于 operation 的 CRDT
   1. 每个实例收发预先定义好的操作，传输的数据量比较小

## 案例

CRDT 技术在网络中的应用，比如：

1. Redis, 用于缓存数据分布式存储
2. Yjs 提供协同编辑的文档的实现基础

## Yjs 的优化

- 按顺序插入的相邻的多个数据进行合并
- 如果内容被删除，内容及其子节点都会被标记成对应的墓碑，等到 GC 的时候回收
